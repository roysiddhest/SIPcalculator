<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Investment Calculator</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
* { 
    margin: 0; 
    padding: 0; 
    box-sizing: border-box; 
}

/* SIP Button Row */
.sip-button-row {
    display: flex;
    gap: 12px;
    margin-bottom: 6px;
    margin-top: 4px;
    width: 100%;
}

.sip-button-left {
    flex: 1;
    position: relative;
}

.sip-button-right {
    flex: 1;
}

.sip-options-button {
    width: 100%;
    height: 42px;
    background: linear-gradient(45deg, #1a73e8, #4285f4);
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.15s ease;
}

.sip-options-button:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(52, 168, 83, 0.2);
}

.sip-saved-button {
    width: 100%;
    height: 42px;
    background: linear-gradient(45deg, #1a73e8, #4285f4);
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.15s ease;
}

.sip-saved-button:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(26, 115, 232, 0.2);
}


.sip-option-item:last-child {
    margin-bottom: 0;
}

.sip-option-item:hover {
    background: var(--border);
    transform: translateY(-1px);
}

/* Step-up Input Section */
.stepup-input-section {
    margin-bottom: 16px;
    padding: 16px;
    background: var(--bg-primary);
    border: 1px solid var(--border);
    border-radius: 8px;
}

/* Responsive adjustments */
@media (max-width: 1200px) {
    .sip-button-row {
        width: 100%;
        max-width: 420px;
    }
}

/* Download Section */
.download-section {
    margin-top: 12px;     /* Added padding above to separate from graph */
    margin-bottom: 16px;
    width: 350px;
}

@media (max-width: 768px) {
    .download-section {
        margin-top: 26px;  /* increased margin for mobile */
    }
}


.download-toggle {
    width: 100%;
    height: 38px;         /* Reduced from 42px to make it smaller */
    background: linear-gradient(45deg, #1a73e8, #4285f4);
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 13px;      /* Reduced from 14px */
    font-weight: 600;
    cursor: pointer;
    transition: all 0.15s ease;
    margin-bottom: 8px;
}


.download-toggle:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(26, 115, 232, 0.2);
}

.download-options {
    display: flex;
    gap: 8px;
    width: 100%;
}

.download-option {
    flex: 1;
    height: 38px;
    background: var(--bg-secondary);
    color: var(--text-primary);
    border: 1px solid var(--border);
    border-radius: 6px;
    font-size: 13px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.15s ease;
}

.download-option:hover {
    background: var(--border);
    transform: translateY(-1px);
}

/* Responsive adjustments */
@media (max-width: 1200px) {
    .download-section {
        width: 100%;
        max-width: 420px;
    }
}

:root {
    --bg-primary: #f8f9fa;
    --bg-secondary: #fff;
    --text-primary: #202124;
    --text-secondary: #5f6368;
    --border: #dadce0;
    --accent: #1a73e8;
    --success: #34a853;
    --warning: #ea4335;
    --shadow: rgba(60, 64, 67, 0.06);
    --shadow-hover: rgba(60, 64, 67, 0.12);
}

[data-theme="dark"] {
    --bg-primary: #121212;
    --bg-secondary: #1e1e1e;
    --text-primary: #e8eaed;
    --text-secondary: #9aa0a6;
    --border: #3c4043;
    --shadow: rgba(0, 0, 0, 0.15);
    --shadow-hover: rgba(0, 0, 0, 0.25);
}

body {
    font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
    background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
    color: var(--text-primary);
    min-height: 100vh;
    display: flex;
    align-items: flex-start;
    justify-content: center;
    padding: 20px;
    padding-top: 30px;
    transition: all 0.15s ease;
}

@media (min-width: 1024px) {
    body {
        align-items: center;
        padding-top: 20px;
    }
}

.theme-toggle {
    position: fixed;
    top: 24px;
    right: 24px;
    width: 48px;
    height: 48px;
    border: 1px solid var(--border);
    border-radius: 50%;
    background: var(--bg-secondary);
    color: var(--text-primary);
    font-size: 20px;
    cursor: pointer;
    box-shadow: 0 2px 8px var(--shadow);
    transition: all 0.15s ease;
    z-index: 1000;
}

.theme-toggle:hover {
    transform: translateY(-1px);
    box-shadow: 0 3px 12px var(--shadow-hover);
}

.currency-toggle {
    position: fixed;
    top: 80px;
    right: 24px;
    width: 48px;
    height: 48px;
    border: 1px solid var(--border);
    border-radius: 50%;
    background: var(--bg-secondary);
    color: var(--text-primary);
    font-size: 24px;
    font-weight: 400;
    cursor: pointer;
    box-shadow: 0 2px 8px var(--shadow);
    transition: all 0.15s ease;
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: center;
}

.currency-toggle:hover {
    transform: translateY(-1px);
    box-shadow: 0 3px 12px var(--shadow-hover);
}

.info-toggle {
    position: fixed;
    top: 136px;
    right: 24px;
    width: 48px;
    height: 48px;
    border: 1px solid var(--border);
    border-radius: 50%;
    background: var(--bg-secondary);
    color: var(--text-primary);
    font-size: 22px;
    font-weight: 600;
    cursor: pointer;
    box-shadow: 0 2px 8px var(--shadow);
    transition: all 0.15s ease;
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: center;
}

.info-toggle:hover {
    transform: translateY(-1px);
    box-shadow: 0 3px 12px var(--shadow-hover);
}

.info-popup {
    position: fixed;
    top: 136px;
    right: 80px;
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 12px 16px;
    font-size: 14px;
    font-weight: 500;
    color: var(--text-primary);
    box-shadow: 0 3px 12px var(--shadow-hover);
    z-index: 1001;
    white-space: nowrap;
    opacity: 0;
    transform: translateX(10px);
    transition: all 0.15s ease;
    pointer-events: none;
}

.info-popup.show {
    opacity: 1;
    transform: translateX(0);
    pointer-events: auto;
}

.info-popup::after {
    content: '';
    position: absolute;
    top: 50%;
    right: -6px;
    transform: translateY(-50%);
    width: 0;
    height: 0;
    border-left: 6px solid var(--bg-secondary);
    border-top: 6px solid transparent;
    border-bottom: 6px solid transparent;
}

.container {
    background: var(--bg-secondary);
    border-radius: 24px;
    box-shadow: 0 4px 16px var(--shadow);
    width: 100%;
    max-width: 480px;
    overflow: visible;
    backdrop-filter: blur(10px);
    border: 1px solid var(--border);
    transition: all 0.15s ease;
    position: relative;
}

.container:hover {
    box-shadow: 0 6px 20px var(--shadow-hover);
}

.tabs {
    display: flex;
    background: var(--bg-primary);
    position: relative;
    border-radius: 24px 24px 0 0;
}

.tab {
    flex: 1;
    padding: 20px;
    text-align: center;
    font-weight: 600;
    font-size: 15px;
    color: var(--text-secondary);
    border: none;
    background: none;
    cursor: pointer;
    transition: all 0.15s ease;
    position: relative;
}

.tab:first-child {
    border-radius: 24px 0 0 0;
}

.tab:last-child {
    border-radius: 0 24px 0 0;
}

.tab.active {
    color: var(--accent);
}

.tab::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 50%;
    width: 0;
    height: 3px;
    background: var(--accent);
    border-radius: 2px;
    transform: translateX(-50%);
    transition: width 0.15s ease;
}

.tab.active::after {
    width: 60%;
}

.tab-content {
    padding: 24px;
}

#basic {
    padding-top: 4px; 
}
/* SIP History Dropdown */
.sip-history-dropdown {
    background: var(--bg-primary);
    border: 1px solid var(--border);
    border-radius: 12px;
    margin-top: 12px;
    padding: 12px;
    max-height: 300px;
    overflow-y: auto;
    box-shadow: 0 2px 8px var(--shadow);
}

.sip-history-list {
    max-height: 240px;
    overflow-y: auto;
}

.sip-history-item {
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 12px;
    margin-bottom: 8px;
    font-size: 12px;
    cursor: pointer;
    transition: all 0.15s ease;
}

.sip-history-item:hover {
    box-shadow: 0 2px 6px var(--shadow);
    transform: translateY(-1px);
}

.sip-history-item:last-child {
    margin-bottom: 0;
}

.sip-history-values {
    display: flex;
    justify-content: space-between;
    margin-bottom: 4px;
    font-weight: 600;
    color: var(--text-primary);
}

.sip-history-result {
    color: var(--accent);
    font-size: 11px;
    text-align: right;
}


/* DISPLAY AREA WITH EXPRESSION ABOVE AND HISTORY IN TOP RIGHT */
.display-area {
    position: relative;
    margin-bottom: 20px;
}

.expression-history-container {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 10px;
    min-height: 28px;
}

/* EXPRESSION DISPLAY (TOP LEFT) */
.expression-display {
    font-size: 16px;
    color: var(--text-secondary);
    text-align: left;
    flex: 1;
    padding: 6px 10px;
    background: transparent;
    border: none;
    outline: none;
    user-select: none;
    font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
}

/* HISTORY TOGGLE (TOP RIGHT) */
.history-toggle-mini {
    font-size: 16px;
    color: var(--text-secondary);
    background: none;
    border: none;
    cursor: pointer;
    padding: 8px 12px;
    border-radius: 10px;
    transition: all 0.15s ease;
    font-weight: 500;
}

.history-toggle-mini:hover {
    background: var(--border);
}

/* HISTORY DROPDOWN (MINI) */
.history-dropdown-mini {
    position: absolute;
    top: 0px;
    right: -250px;
    width: 240px;
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.2s ease;
    z-index: 100;
}

.history-dropdown-mini.open {
    max-height: 160px;
}

.history-list-mini {
    background: var(--bg-primary);
    border: 1px solid var(--border);
    border-radius: 12px;
    max-height: 120px; /* Reduced to leave room for clear button */
    overflow-y: auto;
    overflow-x: hidden; /* Hide horizontal overflow */
    padding: 8px;
}

.history-item-mini {
    padding: 8px 10px;
    font-size: 14px;
    color: var(--text-secondary);
    border-radius: 8px;
    cursor: pointer;
    transition: background 0.1s;
    word-wrap: break-word; /* Allow equations to wrap to new lines */
    white-space: normal; /* Allow text wrapping */
    line-height: 1.3; /* Better spacing for wrapped text */
}

.history-item-mini:hover {
    background: var(--border);
}

.clear-history-mini {
    width: 100%;
    padding: 8px;
    margin-top: 8px;
    background: var(--accent);
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 12px;
    cursor: pointer;
    transition: opacity 0.1s;
    font-weight: 500;
}

.clear-history-mini:hover {
    opacity: 0.9;
}

/* MAIN DISPLAY */
.display {
    width: 100%;
    height: 80px;
    font-size: 32px;
    font-weight: 300;
    text-align: right;
    border: 2px solid var(--border);
    border-radius: 16px;
    padding: 0 20px;
    background: var(--bg-primary);
    color: var(--text-primary);
    transition: all 0.15s ease;
    -webkit-border-radius: 16px;
    -moz-border-radius: 16px;
    -ms-border-radius: 16px;
    -o-border-radius: 16px;
    border-top-left-radius: 16px !important;
    border-top-right-radius: 16px !important;
    border-bottom-left-radius: 16px !important;
    border-bottom-right-radius: 16px !important;
    overflow: hidden;
    -webkit-background-clip: padding-box;
    -moz-background-clip: padding;
    background-clip: padding-box;
    position: relative;
    -webkit-transform: translateZ(0);
    transform: translateZ(0);
    will-change: transform;
}

.display:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.1);
    outline: none;
}

/* CALCULATOR BUTTONS */
.buttons {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 12px;
}

button.calc-btn {
    height: 64px;
    border: 1px solid var(--border);
    border-radius: 16px;
    font-size: 18px;
    font-weight: 500;
    background: var(--bg-secondary);
    color: var(--text-primary);
    cursor: pointer;
    transition: all 0.1s ease;
    position: relative;
    overflow: hidden;
    -webkit-border-radius: 16px;
    -moz-border-radius: 16px;
    -ms-border-radius: 16px;
    -o-border-radius: 16px;
    border-top-left-radius: 16px !important;
    border-top-right-radius: 16px !important;
    border-bottom-left-radius: 16px !important;
    border-bottom-right-radius: 16px !important;
    -webkit-background-clip: padding-box;
    -moz-background-clip: padding;
    background-clip: padding-box;
}

button.calc-btn::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 50%;
    transform: translate(-50%, -50%);
    transition: width 0.2s, height 0.2s;
}

button.calc-btn:hover::before {
    width: 80px;
    height: 80px;
}

button.calc-btn:hover {
    transform: none;
    box-shadow: 0 2px 8px var(--shadow);
}

button.calc-btn:active {
    transform: scale(0.99);
}

button.calc_operator {
    background: var(--accent);
    color: white;
    border: none;
}

button.equals {
    background: var(--success);
    color: white;
    border: none;
    grid-column: span 1;
}

button.zero {
    grid-column: span 1;
}

button.clear {
    background: var(--warning);
    color: white;
    border: none;
}

/* SIP Form */
.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    font-size: 14px;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 8px;
}

.form-group input,
.form-group select {
    width: 100%;
    height: 48px;
    border: 2px solid var(--border);
    border-radius: 12px;
    padding: 0 16px;
    font-size: 16px;
    background: var(--bg-primary);
    color: var(--text-primary);
    transition: all 0.15s ease;
    -webkit-border-radius: 12px;
    -moz-border-radius: 12px;
    -ms-border-radius: 12px;
    -o-border-radius: 12px;
    border-top-left-radius: 12px !important;
    border-top-right-radius: 12px !important;
    border-bottom-left-radius: 12px !important;
    border-bottom-right-radius: 12px !important;
    -webkit-background-clip: padding-box;
    -moz-background-clip: padding;
    background-clip: padding-box;
}

.form-group input:focus,
.form-group select:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.1);
    outline: none;
}

/* SIP SECTION SEPARATOR */
.sip-separator {
    margin: 6px 0;

}

.calculate-compound {
    width: 100%;
    height: 52px;
    background: linear-gradient(45deg, #34a853, #137333);
    color: white;
    border: none;
    border-radius: 12px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.15s ease;
    margin-bottom: 10px;
    -webkit-border-radius: 12px;
    -moz-border-radius: 12px;
    -ms-border-radius: 12px;
    -o-border-radius: 12px;
    border-top-left-radius: 12px !important;
    border-top-right-radius: 12px !important;
    border-bottom-left-radius: 12px !important;
    border-bottom-right-radius: 12px !important;
    -webkit-background-clip: padding-box;
    -moz-background-clip: padding;
    background-clip: padding-box;
}

.calculate-compound:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(26, 115, 232, 0.2);
}

/* SIP Layout */
.sip-layout {
    display: block;
    padding: 24px !important;
}

.sip-left {
    display: flex;
    flex-direction: column;
    width: 100%;
}

.sip-right {
    position: absolute;
    left: 100%;
    top: 0;
    margin-left: 20px;
    display: none; /* Initially hidden */
    flex-direction: column;
    justify-content: flex-start;
    align-items: center;
    width: 350px;
    height: 100%;
    opacity: 0;
    transform: translateX(-20px);
    transition: all 0.2s ease;
}

.sip-right.show {
    display: flex;
    opacity: 1;
    transform: translateX(0);
}

.results-summary {
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin-bottom: 20px;
    width: 350px;
}

.results {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.result-card {
    background: linear-gradient(135deg, var(--bg-primary), var(--bg-secondary));
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 12px 16px;
    text-align: center;
    transition: all 0.15s ease;
    box-shadow: 0 1px 4px var(--shadow);
    -webkit-border-radius: 8px;
    -moz-border-radius: 8px;
    -ms-border-radius: 8px;
    -o-border-radius: 8px;
    border-top-left-radius: 8px !important;
    border-top-right-radius: 8px !important;
    border-bottom-left-radius: 8px !important;
    border-bottom-right-radius: 8px !important;
    -webkit-background-clip: padding-box;
    -moz-background-clip: padding;
    background-clip: padding-box;
    width: 350px;
    min-width: 350px;
    max-width: 350px;
}

.result-card:hover {
    transform: none;
    box-shadow: 0 2px 6px var(--shadow);
}

.result-label {
    font-size: 11px;
    color: var(--text-secondary);
    margin-bottom: 4px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.result-value {
    font-size: 18px;
    font-weight: 700;
    color: var(--accent);
    line-height: 1;
}
.result-value.neutral {
color: var(--text-primary);
font-weight: 600;
}

/* PIE CHART CONTAINER - ADJUSTED POSITIONING */
.chart-container {
    position: relative;
    width: 350px;
    height: 180px;
    background: var(--bg-primary);
    border-radius: 12px;
    padding: 10px;
    border: 1px solid var(--border);
    box-shadow: 0 2px 8px var(--shadow);
    margin-top: -4px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    -webkit-border-radius: 12px;
    -moz-border-radius: 12px;
    -ms-border-radius: 12px;
    -o-border-radius: 12px;
    border-top-left-radius: 12px !important;
    border-top-right-radius: 12px !important;
    border-bottom-left-radius: 12px !important;
    border-bottom-right-radius: 12px !important;
    -webkit-background-clip: padding-box;
    -moz-background-clip: padding;
    background-clip: padding-box;
}

.chart-wrapper {
    margin-top: 0px; /* shifted up by 2px */
    width: 144px;
    height: 170px;
    position: relative;
    margin-bottom: 0px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.chart-percentage-display {
    margin-top: -30px; /* increased negative margin from -32px - moves text up */
    background: transparent;
    border: none;
    border-radius: 0;
    padding: 8px 12px;
    box-shadow: none;
    width: 180px;
}

.percentage-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin: 3px 0;
    font-size: 13px;
    font-weight: 500;
}

.percentage-color {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    margin-right: 6px;
}

.percentage-left {
    display: flex;
    align-items: center;
}

.percentage-right {
    font-weight: 700;
    color: var(--text-primary);
    font-size: 14px;
}

/* GROWTH GRAPH CONTAINER */
.growth-graph-container {
    position: relative;
    width: 350px;
    height: 300px; /* reduced by 10% from 324px */
    background: var(--bg-primary);
    border-radius: 12px;
    padding: 10px;
    border: 1px solid var(--border);
    box-shadow: 0 2px 8px var(--shadow);
    margin-top: 12px;
    -webkit-border-radius: 12px;
    -moz-border-radius: 12px;
    -ms-border-radius: 12px;
    -o-border-radius: 12px;
    border-top-left-radius: 12px !important;
    border-top-right-radius: 12px !important;
    border-bottom-left-radius: 12px !important;
    border-bottom-right-radius: 12px !important;
    -webkit-background-clip: padding-box;
    -moz-background-clip: padding;
    background-clip: padding-box;
}

.growth-chart-wrapper {
    width: 100%;
    height: 260px; /* reduced by 10% from 288px */
    position: relative;
}

/* Split field styling */
.split-field {
    display: flex;
    width: 100%;
    height: 48px;
    border: 2px solid var(--border);
    border-radius: 12px;
    overflow: hidden;
    position: relative;
    background: var(--bg-primary);
    transition: all 0.15s ease;
    -webkit-border-radius: 12px;
    -moz-border-radius: 12px;
    -ms-border-radius: 12px;
    -o-border-radius: 12px;
    border-top-left-radius: 12px !important;
    border-top-right-radius: 12px !important;
    border-bottom-left-radius: 12px !important;
    border-bottom-right-radius: 12px !important;
    -webkit-background-clip: padding-box;
    -moz-background-clip: padding;
    background-clip: padding-box;
}

.split-field:focus-within {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.1);
}

.split-field-main {
    flex: 2; /* 2/3 of the width */
    position: relative;
}

.split-field-secondary {
    flex: 1; /* 1/3 of the width */
    position: relative;
    border-left: 2px solid var(--border);
}

.split-field input,
.split-field select {
    width: 100%;
    height: 100%;
    border: none;
    background: transparent;
    padding: 0 16px;
    font-size: 16px;
    color: var(--text-primary);
    outline: none;
}

.split-field select {
    padding-right: 30px; /* Space for dropdown arrow */
}

/* Animations */
@keyframes slideIn {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.tab-content {
    animation: slideIn 0.2s ease;
}

/* Responsive Design */
@media (max-width: 1200px) {
    .sip-right {
        position: relative;
        left: auto;
        top: auto;
        margin-left: 0;
        margin-top: 20px;
        width: 100%;
        opacity: 1;
        transform: none;
    }
    
    .sip-right.show {
        opacity: 1;
        transform: none;
    }
    
    .results-summary,
    .result-card,
    .chart-container,
    .growth-graph-container {
        width: 100%;
        max-width: 420px;
        min-width: auto;
    }
    
    .chart-wrapper,
    .chart-percentage-display {
        margin-top: -35px;
        width: 180px;
    }
}

@media (max-width: 1024px) {
    .sip-layout {
        display: block;
    }
    
    .sip-left {
        max-width: 100%;
    }
    
    .container {
        max-width: 500px;
    }
}

@media (max-width: 768px) {
    .container {
        max-width: 100%;
        margin: 0 8px;
        border-radius: 20px;
    }
    
    .tabs {
        border-radius: 20px 20px 0 0;
    }
    
    .tab:first-child {
        border-radius: 20px 0 0 0;
    }
    
    .tab:last-child {
        border-radius: 0 20px 0 0;
    }
    
    .display {
        font-size: 28px;
        height: 72px;
    }
    
    button.calc-btn {
        height: 56px;
        font-size: 16px;
    }
    
    .theme-toggle, .currency-toggle, .info-toggle {
        width: 44px;
        height: 44px;
    }
    
    .results-summary,
    .result-card,
    .chart-container,
    .growth-graph-container {
        width: 100%;
        max-width: 380px;
        min-width: auto;
    }
    
    .chart-wrapper,
    .chart-percentage-display {
        margin-top: -35px;
        width: 160px;
    }
    
    .percentage-item {
        font-size: 12px;
    }
    
    .percentage-right {
        font-size: 13px;
    }
}

@media (max-width: 480px) {
    .container {
        max-width: 100%;
        margin: 0 6px;
        border-radius: 18px;
    }
    
    .tabs {
        border-radius: 18px 18px 0 0;
    }
    
    .tab:first-child {
        border-radius: 18px 0 0 0;
    }
    
    .tab:last-child {
        border-radius: 0 18px 0 0;
    }
    
    .display {
        font-size: 24px;
        height: 64px;
    }
    
    button.calc-btn {
        height: 48px;
        font-size: 16px;
    }
    
    .chart-wrapper,
    .chart-percentage-display {
        margin-top: -35px;
        width: 140px;
    }
    
    .percentage-item {
        font-size: 11px;
    }
    
    .percentage-right {
        font-size: 12px;
    }
    
    .growth-graph-container {
        height: 261px; /* reduced for mobile */
    }
    
    .growth-chart-wrapper {
        height: 233px; /* reduced for mobile */
    }
}

/* Scrollbar Styling */
::-webkit-scrollbar {
    width: 6px;
}

::-webkit-scrollbar-track {
    background: var(--bg-primary);
    border-radius: 3px;
}

::-webkit-scrollbar-thumb {
    background: var(--border);
    border-radius: 3px;
}

::-webkit-scrollbar-thumb:hover {
    background: var(--text-secondary);
}


</style>
</head>
<body>
<button class="theme-toggle" id="themeToggle" onclick="toggleTheme()">🌙</button>
<button class="currency-toggle" id="currencyToggle" onclick="toggleCurrency()">₹</button>
<button class="info-toggle" id="infoToggle" onclick="toggleInfo()">i</button>
<div class="info-popup" id="infoPopup">App Developed by Siddhest Roy</div>
<div class="container">
<div class="tabs">
<button class="tab active" onclick="switchTab('sip', event)">Investment</button>
<button class="tab" onclick="switchTab('basic', event)">Calculator</button>
</div>
<!-- SIP Calculator - NOW FIRST AND DEFAULT -->
<div class="tab-content sip-layout" id="sip">
<div class="sip-left">
<div class="form-group">
<label for="principal">Lump Sum</label>
<input id="principal" min="0" placeholder="Optional" step="100" type="number"/>
</div>

<div class="form-group">
<div style="display: flex; justify-content: space-between; margin-bottom: 0px;">
<label for="recurringPayment">SIP Amount</label>
<label for="paymentFrequency">Frequency</label>
</div>
<div class="split-field">
<div class="split-field-main">
<input id="recurringPayment" min="0" placeholder="Optional" step="100" type="number"/>
</div>
<div class="split-field-secondary">
<select id="paymentFrequency">
<option value="12">Monthly</option>
<option value="4">Quarterly</option>
<option value="2">Semi-annually</option>
<option value="1">Annually</option>
</select>
</div>
</div>
</div>

<div class="form-group">
<label for="interestRate">Annual Return</label>
<input id="interestRate" max="100" min="0" placeholder="%" step="0.1" type="number"/>
</div>

<div class="form-group">
<div style="display: flex; justify-content: space-between; margin-bottom: 0px;">
<label for="timePeriod">Time</label>
<label for="compoundingFrequency">Compounding</label>
</div>
<div class="split-field">
<div class="split-field-main">
<input id="timePeriod" min="0" placeholder="Years" step="0.5" type="number"/>
</div>
<div class="split-field-secondary">
<select id="compoundingFrequency">
<option selected="" value="1">Annually</option>
<option value="2">Semi-annually</option>
<option value="4">Quarterly</option>
<option value="12">Monthly</option>
<option value="365">Daily</option>
</select>
</div>
</div>
</div>

<!-- SIP SEPARATOR -->
<div class="sip-separator"></div>

<!-- KEEP THESE EXISTING BUTTONS -->
<button class="calculate-compound" onclick="calculateCompoundInterest()">
    Calculate Returns
</button>

<!-- Replace your button row section with this complete structure -->
<div class="sip-button-row">
    <div class="sip-button-left">
        <button class="sip-options-button" onclick="toggleStepUpSip()" id="sipOptionsButton">
            📈 Step-Up
        </button>
    </div>
    
    <div class="sip-button-right">
        <button class="sip-saved-button" onclick="toggleSipHistory()">
            📊 Saved
        </button>
    </div>
</div>

<!-- Step-up SIP input field -->
<div class="stepup-input-section" id="stepupInputSection" style="display: none;">
    <div class="form-group">
        <label for="stepupPercentage">Yearly Increase in SIP</label>
        <input id="stepupPercentage" min="0" max="50" placeholder="%" step="1" type="number"/>
    </div>
</div>


<!-- ADD THIS DROPDOWN CONTAINER -->
<div class="sip-history-dropdown" id="sipHistoryDropdown" style="display: none;">
    <div class="sip-history-list" id="sipHistoryList">
        <div style="text-align: center; color: var(--text-secondary); font-size: 13px; padding: 12px;">
            No History
        </div>
    </div>
    <button class="clear-history-mini" onclick="clearSipHistory()" style="margin-top: 8px;">Clear All</button>
</div>

</div>
<div class="sip-right" id="sipRightPanel">
<div class="results-summary">
<div class="results" id="compoundResults"></div>
</div>
<div class="chart-container">
<div class="chart-wrapper">
<canvas id="compoundChart"></canvas>
</div>
<div class="chart-percentage-display" id="chartPercentages"></div>
</div>
<div class="growth-graph-container">
<div class="growth-chart-wrapper">
<canvas id="growthChart"></canvas>
</div>
</div>
<!-- Download section should be HERE in the results panel -->
<div class="download-section">
    <button class="download-toggle" onclick="toggleDownloadOptions()" id="downloadButton">
        📥 Download Report
    </button>
    <div class="download-options" id="downloadOptions" style="display: none;">
        <button class="download-option" onclick="downloadCSV()">📊 Download CSV</button>
        <button class="download-option" onclick="downloadPDF()">📄 Download PDF</button>
    </div>
</div>

</div>
</div>
<!-- Basic Calculator - NOW SECOND -->
<div class="tab-content" id="basic" style="display: none;">
<div class="display-area">
<div class="expression-history-container">
<div class="expression-display" id="expressionDisplay"></div>
<button class="history-toggle-mini" onclick="toggleMiniHistory()">📜 </button>
<div class="history-dropdown-mini" id="historyDropdownMini">
<div class="history-list-mini" id="historyListMini">
<div style="text-align: center; color: var(--text-secondary); font-size: 13px; padding: 12px;">
                            No calculations yet
                        </div>
</div>
<button class="clear-history-mini" onclick="calc_clearCalculatorHistory()">Clear</button>
</div>
</div>
<input class="display" id="display" placeholder="0" readonly="" type="text"/>
</div>
<div class="buttons">
    <button class="calc-btn clear" onclick="calc_clearAll()">C</button>
    <button class="calc-btn" onclick="calc_clearEntry()">CE</button>
    <button class="calc-btn" onclick="calc_backspace()">⌫</button>
    <button class="calc-btn calc_operator" onclick="calc_calculateSquareRoot()">√</button>
    
    <button class="calc-btn" onclick="calc_appendNumber('7')">7</button>
    <button class="calc-btn" onclick="calc_appendNumber('8')">8</button>
    <button class="calc-btn" onclick="calc_appendNumber('9')">9</button>
    <button class="calc-btn calc_operator" onclick="calc_appendOperator('/')">÷</button>
    
    <button class="calc-btn" onclick="calc_appendNumber('4')">4</button>
    <button class="calc-btn" onclick="calc_appendNumber('5')">5</button>
    <button class="calc-btn" onclick="calc_appendNumber('6')">6</button>
    <button class="calc-btn calc_operator" onclick="calc_appendOperator('*')">×</button>
    
    <button class="calc-btn" onclick="calc_appendNumber('1')">1</button>
    <button class="calc-btn" onclick="calc_appendNumber('2')">2</button>
    <button class="calc-btn" onclick="calc_appendNumber('3')">3</button>
    <button class="calc-btn calc_operator" onclick="calc_appendOperator('-')">−</button>
    
    <button class="calc-btn" onclick="calc_appendDecimal()">.</button>
    <button class="calc-btn" onclick="calc_appendNumber('0')">0</button>
    <button class="calc-btn" onclick="calc_toggleSign()">+/−</button>
    <button class="calc-btn calc_operator" onclick="calc_appendOperator('+')">+</button>
    
    <button class="calc-btn equals" onclick="calc_calculateResult()" style="grid-column: span 4;">=</button>
</div>

</div>
</div>
<script>
// Calculator State
let calc_currentInput = '';
let calc_operator = '';
let calc_previousInput = '';
let calc_shouldResetDisplay = false;
let calc_calculationHistory = [];
let currentCurrency = 'INR';
let calc_currentExpression = '';

// Download functionality
let currentCalculationData = null;
// SIP Options Management
function toggleSipOptions() {
    const dropdown = document.getElementById('sipOptionsDropdown');
    const button = document.getElementById('sipOptionsButton');
    const stepupSection = document.getElementById('stepupInputSection');
    
    if (dropdown.style.display === 'none') {
        dropdown.style.display = 'block';
        button.textContent = '⚙️ Close';
    } else {
        dropdown.style.display = 'none';
        button.textContent = '⚙️ Options';
        
        // Close the step-up input section when closing options
        stepupSection.style.display = 'none';
    }
}
function getTotalPeriodsUpToYear(year, paymentFrequency, stepupPercentage, sipAmount) {
    let periodsPerYear;

    switch (paymentFrequency) {
        case 1: periodsPerYear = 1; break;   // Yearly
        case 2: periodsPerYear = 2; break;   // Half-yearly
        case 4: periodsPerYear = 4; break;   // Quarterly
        case 12: periodsPerYear = 12; break; // Monthly
        default: periodsPerYear = 1; break;
    }

    let totalPeriods = 0;
    let sip = sipAmount;

    // Add SIP for each full year with step-up applied yearly
    for (let i = 0; i < Math.floor(year); i++) {
        totalPeriods += periodsPerYear;
        sip *= (1 + (stepupPercentage / 100)); 
    }

    // Add partial year periods
    const fractionalPart = year % 1;
    if (fractionalPart > 0) {
        totalPeriods += periodsPerYear * fractionalPart;
    }

    return totalPeriods;
}


// Simplified Step-Up toggle - no dropdown needed
function toggleStepUpSip() {
    const stepupSection = document.getElementById('stepupInputSection');
    const button = document.getElementById('sipOptionsButton');
    
    if (stepupSection.style.display === 'none') {
        stepupSection.style.display = 'block';
        button.textContent = '📈 Close';
    } else {
        stepupSection.style.display = 'none';
        button.textContent = '📈 Step-Up';
    }
}


function toggleDownloadOptions() {
    const options = document.getElementById('downloadOptions');
    const button = document.getElementById('downloadButton');
    
    if (options.style.display === 'none') {
        options.style.display = 'flex';
        button.textContent = '📥 Close';
    } else {
        options.style.display = 'none';
        button.textContent = '📥 Download Report';
    }
}

function downloadCSV() {
    if (!currentCalculationData) {
        alert('Please calculate results first');
        return;
    }

    const { principal, sipAmount, rate, time, totalAmount, totalContributions, totalInterest, growthData, frequency, sipfrequency } = currentCalculationData;

    // Helper to format numbers with spaces instead of commas, based on currency
    function formatNumberWithSpaces(amount) {
        if (currentCurrency === 'USD') {
            return amount.toLocaleString('en-US').replace(/,/g, ' ');
        } else {
            return amount.toLocaleString('en-IN').replace(/,/g, ' ');
        }
    }

    // Get proper frequency labels
    const compoundingFreq = getFrequencyText(parseInt(document.getElementById('compoundingFrequency').value));
    const sipFreq = getFrequencyText(parseInt(document.getElementById('paymentFrequency').value));
    const currencyName = (currentCurrency === 'USD') ? 'USD' : 'INR';

    let csv = '';
    csv += 'Investment Report\n';
    csv += 'Generated on,' + new Date().toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' }) + '\n\n';

    csv += 'Input Parameters\n';
    csv += 'Lump Sum,' + formatNumberWithSpaces(principal) + '\n';
    csv += 'SIP Amount,' + formatNumberWithSpaces(sipAmount) + ',' + sipFreq + '\n';
    csv += 'Annual Return,' + rate + '%\n';
    csv += 'Time,' + time + ' Years, Compounding ' + compoundingFreq + '\n';
    csv += 'Currency,' + currencyName + '\n';
    
    // Add step-up info if applicable
    const stepupPercentage = parseFloat(document.getElementById('stepupPercentage').value) || 0;
    if (stepupPercentage > 0) {
        csv += 'Step-Up SIP,' + stepupPercentage + '% Yearly\n';
    }
    csv += '\n';

    csv += 'Results Summary\n';
    csv += 'Total Invested,' + formatNumberWithSpaces(totalContributions) + '\n';
    csv += 'Interest Earned,' + formatNumberWithSpaces(totalInterest) + '\n';
    csv += 'Final Amount,' + formatNumberWithSpaces(totalAmount) + '\n\n';

    csv += 'Growth Summary\n';
    csv += 'Year,Total Invested,Interest This Year,Total Interest,Total Amount\n';

    // Include ALL growth data points (numbers only, no currency symbols)
    for (let i = 0; i < growthData.length; i++) {
        const item = growthData[i];
        const interestThisYear = item.interest - (growthData[i - 1]?.interest || 0);
        csv += item.year + ',' +
               formatNumberWithSpaces(item.contributions) + ',' +
               formatNumberWithSpaces(interestThisYear) + ',' +
               formatNumberWithSpaces(item.interest) + ',' +
               formatNumberWithSpaces(item.totalAmount) + '\n';
    }

    const filename = 'investment_report_' + new Date().toISOString().split('T')[0] + '.csv';
    const element = document.createElement('a');
    element.setAttribute('href', 'data:text/csv;charset=utf-8,' + encodeURIComponent(csv));
    element.setAttribute('download', filename);
    element.style.display = 'none';
    document.body.appendChild(element);
    element.click();
    document.body.removeChild(element);

    toggleDownloadOptions();
}

// FIXED: Download PDF function with proper frequency display and complete data
function downloadPDF() {
    if (!currentCalculationData) {
        alert('Please calculate results first');
        return;
    }

    const { principal, sipAmount, rate, time, totalAmount, totalContributions, totalInterest, growthData } = currentCalculationData;

    // Get proper frequency labels from actual form values
    const compoundingFreq = getFrequencyText(parseInt(document.getElementById('compoundingFrequency').value));
    const sipFreq = getFrequencyText(parseInt(document.getElementById('paymentFrequency').value));
    const stepupPercentage = parseFloat(document.getElementById('stepupPercentage').value) || 0;
    const currencyName = (currentCurrency === 'USD') ? 'USD' : 'INR';

    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    doc.setFontSize(18);
    doc.setFont(undefined, 'bold');
    doc.text('Investment Report', 20, 25);

    doc.setFontSize(10);
    doc.setFont(undefined, 'normal');
    doc.text('Generated on: ' + new Date().toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' }), 20, 35);

    // Input Parameters
    doc.setFontSize(14);
    doc.setFont(undefined, 'bold');
    doc.text('Input Parameters', 20, 50);

    // local helper to remove currency symbols but keep formatting (commas/decimals)
    const stripSymbols = (amt) => formatCurrency(amt).replace(/[₹$]/g, '');

    doc.setFontSize(11);
    doc.setFont(undefined, 'normal');
    let yPos = 60;
    doc.text('Lump Sum: ' + stripSymbols(principal), 20, yPos);
    yPos += 8;
    doc.text('SIP Amount: ' + stripSymbols(sipAmount) + ' ' + sipFreq, 20, yPos);
    yPos += 8;
    doc.text('Annual Return: ' + rate + '%', 20, yPos);
    yPos += 8;
    doc.text('Time: ' + time + ' Years, Compounding ' + compoundingFreq, 20, yPos);
    yPos += 8;
    doc.text('Currency: ' + currencyName, 20, yPos);

    if (stepupPercentage > 0) {
        yPos += 8;
        doc.text('Step-Up SIP: ' + stepupPercentage + '% Yearly', 20, yPos);
    }

    // Results Summary
    yPos += 20;
    doc.setFontSize(14);
    doc.setFont(undefined, 'bold');
    doc.text('Results Summary', 20, yPos);

    yPos += 10;
    doc.setFontSize(11);
    doc.setFont(undefined, 'normal');
    doc.text('Total Invested: ' + stripSymbols(totalContributions), 20, yPos);
    yPos += 8;
    doc.text('Total Interest Earned: ' + stripSymbols(totalInterest), 20, yPos);
    yPos += 8;
    doc.text('Final Amount: ' + stripSymbols(totalAmount), 20, yPos);

    // Growth Summary Table
    yPos += 20;
    doc.setFontSize(14);
    doc.setFont(undefined, 'bold');
    doc.text('Growth Summary', 20, yPos);

    yPos += 10;
    doc.setFontSize(9);
    doc.setFont(undefined, 'normal');

    // Column headers
    doc.text('Year', 20, yPos);
    doc.text('Invested', 40, yPos);
    doc.text('Interest This Year', 75, yPos);
    doc.text('Total Interest', 115, yPos);
    doc.text('Total Amount', 150, yPos);

    yPos += 8;

    // Show ALL growth data, handle page breaks, values only (no currency symbols)
    for (let i = 0; i < growthData.length; i++) {
        // Check if we need a new page
        if (yPos > 270) {
            doc.addPage();
            yPos = 20;
            
            // Repeat headers on new page
            doc.setFontSize(9);
            doc.setFont(undefined, 'normal');
            doc.text('Year', 20, yPos);
            doc.text('Invested', 40, yPos);
            doc.text('Interest This Year', 75, yPos);
            doc.text('Total Interest', 115, yPos);
            doc.text('Total Amount', 150, yPos);
            yPos += 8;
        }
        
        const item = growthData[i];
        const interestThisYear = item.interest - (growthData[i - 1]?.interest || 0);
        
        // Format numbers to fit in columns (no currency symbols)
        const formatForPDF = (amount) => {
            const formatted = formatCurrency(amount).replace(/[₹$]/g, '');
            if (formatted.length > 12) {
                // Truncate long numbers for PDF display (suffixes without symbols)
                if (currentCurrency === 'INR') {
                    if (amount >= 10000000) return (amount / 10000000).toFixed(1) + 'Cr';
                    if (amount >= 100000) return (amount / 100000).toFixed(1) + 'L';
                } else {
                    if (amount >= 1000000) return (amount / 1000000).toFixed(1) + 'M';
                    if (amount >= 1000) return (amount / 1000).toFixed(1) + 'K';
                }
            }
            return formatted;
        };
        
        doc.text(item.year.toString(), 20, yPos);
        doc.text(formatForPDF(item.contributions), 40, yPos);
        doc.text(formatForPDF(interestThisYear), 75, yPos);
        doc.text(formatForPDF(item.interest), 115, yPos);
        doc.text(formatForPDF(item.totalAmount), 150, yPos);
        yPos += 6;
    }

    // Footer
    doc.setFontSize(8);
    doc.text('Generated by Investment Calculator App', 20, 285);

    const filename = 'investment_report_' + new Date().toISOString().split('T')[0] + '.pdf';
    doc.save(filename);

    toggleDownloadOptions();
}


function clearSipHistory() {
    sipHistoryData = [];
    updateSipHistoryDisplay();
    
    // Optionally close the dropdown after clearing
    document.getElementById('sipHistoryDropdown').style.display = 'none';
    document.querySelector('.sip-saved-button').textContent = '📊 Saved';
}


// Helper function to format currency without symbols for CSV
function formatCurrencyPlain(amount) {
    if (amount === null || amount === undefined) return '0';
    return parseFloat(amount).toFixed(2);
}

function formatCurrencyINR(amount) {
    amount = parseFloat(amount).toFixed(2);
    const [whole, decimal] = amount.split('.');

    if (whole.length <= 3) {
        return `₹${whole}${decimal ? '.' + decimal : ''}`;
    }

    const lastThree = whole.slice(-3);
    let rest = whole.slice(0, -3);
    rest = rest.replace(/\B(?=(\d{2})+(?!\d))/g, ",");

    return `₹${rest},${lastThree}${decimal ? '.' + decimal : ''}`;
}

function formatCurrencyUSD(amount) {
    return `$${parseFloat(amount).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
}

function formatCurrency(amount) {
    if (currentCurrency === 'INR') {
        return formatCurrencyINR(amount);
    } else {
        return formatCurrencyUSD(amount);
    }
}

// Theme Management
function toggleTheme() {
    const body = document.body;
    const themeToggle = document.getElementById('themeToggle');
    
    if (body.getAttribute('data-theme') === 'dark') {
        body.removeAttribute('data-theme');
        themeToggle.textContent = '🌙';
        localStorage.setItem('theme', 'light');
    } else {
        body.setAttribute('data-theme', 'dark');
        themeToggle.textContent = '☀️';
        localStorage.setItem('theme', 'dark');
    }
}

// Currency Management
function toggleCurrency() {
    const currencyToggle = document.getElementById('currencyToggle');
    
    if (currentCurrency === 'INR') {
        currentCurrency = 'USD';
        currencyToggle.textContent =  '$';
        localStorage.setItem('currency', 'USD');
    } else {
        currentCurrency = 'INR';
        currencyToggle.textContent = '₹';
        localStorage.setItem('currency', 'INR');
    }
    
    const resultsContainer = document.getElementById('compoundResults');
    if (resultsContainer && resultsContainer.innerHTML) {
        calculateCompoundInterest();
    }
updateSipHistoryDisplay();

}

// Info Management
function toggleInfo() {
    const infoPopup = document.getElementById('infoPopup');
    infoPopup.classList.toggle('show');
    
    if (infoPopup.classList.contains('show')) {
        setTimeout(() => {
            infoPopup.classList.remove('show');
        }, 6000);
    }
}

// Load saved theme and currency
const savedTheme = localStorage.getItem('theme');
if (savedTheme === 'dark') {
    document.body.setAttribute('data-theme', 'dark');
    document.getElementById('themeToggle').textContent = '☀️';
}

const savedCurrency = localStorage.getItem('currency');
if (savedCurrency === 'USD') {
    currentCurrency = 'USD';
    document.getElementById('currencyToggle').textContent = '$';
} else {
    currentCurrency = 'INR';
    document.getElementById('currencyToggle').textContent = '₹';
}

// Tab Management
function switchTab(tabName, event) {
    document.querySelectorAll('.tab-content').forEach(content => {
        content.style.display = 'none';
    });
    
    document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
    });
    
    const rightPanel = document.getElementById('sipRightPanel');
    if (tabName !== 'sip') {
        rightPanel.classList.remove('show');
    }
    
    document.getElementById(tabName).style.display = 'block';
    event.target.classList.add('active');
}

// Mini History Management
function toggleMiniHistory() {
    const dropdown = document.getElementById('historyDropdownMini');
    dropdown.classList.toggle('open');
}
// Calculator - Toggle Sign Function
function calc_toggleSign() {
    if (calc_currentInput && calc_currentInput !== '0') {
        if (calc_currentInput.startsWith('-')) {
            calc_currentInput = calc_currentInput.substring(1);
        } else {
            calc_currentInput = '-' + calc_currentInput;
        }
        calc_updateDisplay();
    }
}
function getFrequencyText(frequency) {
    switch(parseInt(frequency)) {
        case 12: return 'Monthly';
        case 4: return 'Quarterly';  
        case 2: return 'Semi-annually';
        case 1: return 'Annually';
        case 365: return 'Daily';
        default: return 'Monthly';
    }
}
// Calculator - Square Root Function
function calc_calculateSquareRoot() {
    if (calc_currentInput && calc_currentInput !== '0') {
        const number = parseFloat(calc_currentInput);
        if (number < 0) {
            document.getElementById('display').value = 'Error';
            calc_currentInput = '';
            calc_shouldResetDisplay = true;
            return;
        }
        
        const result = Math.sqrt(number);
        const calculation = `√${number}`;
        
        calc_addToHistory(calculation, result);
        calc_currentInput = result.toString();
        calc_shouldResetDisplay = true;
        calc_updateDisplay();
    }
}

// SIP History Management
let sipHistoryData = [];

function toggleSipHistory() {
    const dropdown = document.getElementById('sipHistoryDropdown');
    const button = document.querySelector('.sip-saved-button'); // Or use an ID if you have one
    
    if (dropdown.style.display === 'none') {
        dropdown.style.display = 'block';
        button.textContent = '📊 Close';
    } else {
        dropdown.style.display = 'none';
        button.textContent = '📊 Saved';
    }
}


function saveSipCalculation(principal, sipAmount, rate, time, totalAmount, totalContributions, totalInterest, frequency, sipfrequency, growthData) {
    // Get step-up percentage when saving
    const stepupPercentage = parseFloat(document.getElementById('stepupPercentage').value) || 0;
    
    // Store current calculation data for downloads
    currentCalculationData = {
        principal: principal,
        sipAmount: sipAmount,
        rate: rate,
        time: time,
        frequency: getFrequencyText(frequency),
        sipfrequency: sipfrequency,
        totalAmount: totalAmount,
        totalContributions: totalContributions,
        totalInterest: totalInterest,
        growthData: growthData || []
    };

    // Check if this exact calculation already exists (including step-up)
    const isDuplicate = sipHistoryData.some(item => 
        item.principal === principal &&
        item.sipAmount === sipAmount &&
        item.rate === rate &&
        item.time === time &&
        item.stepupPercentage === stepupPercentage  // Include step-up in duplicate check
    );
    
    // Only save if it's not a duplicate
    if (!isDuplicate) {
        const calculation = {
            principal: principal,
            sipAmount: sipAmount,
            rate: rate,
            time: time,
            stepupPercentage: stepupPercentage,  // Save step-up percentage
            totalAmount: totalAmount,
            totalContributions: totalContributions,
            totalInterest: totalInterest,
            date: new Date().toLocaleDateString()
        };
        
        sipHistoryData.unshift(calculation);
        if (sipHistoryData.length > 10) {
            sipHistoryData.pop();
        }
        
        updateSipHistoryDisplay();
    }
}
function updateSipHistoryDisplay() {
    const historyList = document.getElementById('sipHistoryList');
    
    if (sipHistoryData.length === 0) {
        historyList.innerHTML = '<div style="text-align: center; color: var(--text-secondary); font-size: 13px; padding: 12px;">No History</div>';
    } else {
        historyList.innerHTML = sipHistoryData
            .map(item => {
                // Add step-up indicator if present
                const stepupIndicator = item.stepupPercentage && item.stepupPercentage > 0 
                    ? ` 📈${item.stepupPercentage}%` 
                    : '';
                
                return `
                    <div class="sip-history-item" onclick="loadSipCalculation(${sipHistoryData.indexOf(item)})">
                        <div class="sip-history-values">
                            <span>${formatCurrency(item.principal)} + ${formatCurrency(item.sipAmount)}/mo${stepupIndicator}</span>
                            <span>${item.rate}% • ${item.time}yr</span>
                        </div>
                        <div class="sip-history-result">
                            Final: ${formatCurrency(item.totalAmount)} | Return: ${formatCurrency(item.totalInterest)}
                        </div>
                    </div>
                `;
            })
            .join('');
    }
}



function loadSipCalculation(index) {
    const calc = sipHistoryData[index];
    
    // Load all saved values into the form, including step-up
    document.getElementById('principal').value = calc.principal;
    document.getElementById('recurringPayment').value = calc.sipAmount;
    document.getElementById('interestRate').value = calc.rate;
    document.getElementById('timePeriod').value = calc.time;
    
    // Load step-up percentage (if it exists in saved data)
    const stepupInput = document.getElementById('stepupPercentage');
    if (calc.stepupPercentage && calc.stepupPercentage > 0) {
        stepupInput.value = calc.stepupPercentage;
        // Show the step-up input section if there was a step-up value
        document.getElementById('stepupInputSection').style.display = 'block';
    } else {
        stepupInput.value = '';
        // Hide the step-up input section if no step-up was used
        document.getElementById('stepupInputSection').style.display = 'none';
    }
    
    // Calculate with the loaded values
    calculateCompoundInterest();
    
    // Close the dropdown
    document.getElementById('sipHistoryDropdown').style.display = 'none';
    document.querySelector('.sip-saved-button').textContent = '📊 Saved';
}



function calc_addToHistory(calculation, result) {
    calc_calculationHistory.unshift(`${calculation} = ${result}`);
    if (calc_calculationHistory.length > 20) {
        calc_calculationHistory.pop();
    }
    calc_updateMiniHistoryDisplay();
}

function calc_updateMiniHistoryDisplay() {
    const historyList = document.getElementById('historyListMini');
    
    if (calc_calculationHistory.length === 0) {
        historyList.innerHTML = '<div style="text-align: center; color: var(--text-secondary); font-size: 13px; padding: 12px;">No History</div>';
    } else {
        historyList.innerHTML = calc_calculationHistory
            .map(item => `<div class="history-item-mini" onclick="calc_loadFromHistory('${item}')">${item}</div>`)
            .join('');
    }
}

function calc_loadFromHistory(historyItem) {
    const result = historyItem.split(' = ')[1];
    document.getElementById('display').value = result;
    calc_currentInput = result;
    calc_shouldResetDisplay = true;
    
    document.getElementById('expressionDisplay').textContent = '';
    calc_currentExpression = '';
}

function calc_clearCalculatorHistory() {
    calc_calculationHistory = [];
    calc_updateMiniHistoryDisplay();
    calc_currentExpression = '';  // Add this line
    calc_updateExpressionDisplay();  // Add this line
}

// Expression Display Update
function calc_updateExpressionDisplay() {
    const expressionDisplay = document.getElementById('expressionDisplay');
    if (calc_currentExpression) {
        expressionDisplay.textContent = calc_currentExpression;
    } else {
        expressionDisplay.textContent = '';
    }
}

// Calculator Logic
function calc_updateDisplay() {
    const display = document.getElementById('display');
    const displayValue = calc_currentInput || '0';
    display.value = displayValue.replace(/\*/g, '×').replace(/\//g, '÷');
}

function calc_appendNumber(number) {
    if (calc_shouldResetDisplay) {
        calc_currentInput = '';
        calc_shouldResetDisplay = false;
    }
    
    if (calc_currentInput === '0' && number !== '.') {
        calc_currentInput = number;
    } else {
        calc_currentInput += number;
    }
    
    // Add these lines to update expression display
    if (calc_operator && calc_previousInput) {
        calc_currentExpression = `${calc_previousInput} ${calc_operator.replace('*', '×').replace('/', '÷')} ${calc_currentInput}`;
        calc_updateExpressionDisplay();
    }
    
    calc_updateDisplay();
}

function calc_appendDecimal() {
    if (calc_shouldResetDisplay) {
        calc_currentInput = '0';
        calc_shouldResetDisplay = false;
    }
    
    if (calc_currentInput === '') {
        calc_currentInput = '0';
    }
    
    if (!calc_currentInput.includes('.')) {
        calc_currentInput += '.';
        calc_updateDisplay();
    }
}

function calc_appendOperator(op) {
    if (calc_operator && calc_currentInput && !calc_shouldResetDisplay) {
        calc_calculateResult();
    }
    
    calc_previousInput = calc_currentInput || '0';
    calc_operator = op;
    calc_shouldResetDisplay = true;
    
    // Add this line to update expression display
    calc_currentExpression = `${calc_previousInput} ${op.replace('*', '×').replace('/', '÷')}`;
    calc_updateExpressionDisplay();
}

function calc_calculateResult() {
    if (!calc_operator || !calc_previousInput || calc_shouldResetDisplay) return;
    
    const prev = parseFloat(calc_previousInput);
    const current = parseFloat(calc_currentInput);
    
    if (isNaN(prev) || isNaN(current)) return;
    
    let result;
    const calculation = `${calc_previousInput} ${calc_operator.replace('*', '×').replace('/', '÷')} ${calc_currentInput}`;
    
    try {
        switch (calc_operator) {
            case '+':
                result = prev + current;
                break;
            case '-':
                result = prev - current;
                break;
            case '*':
                result = prev * current;
                break;
            case '/':
                if (current === 0) {
                    throw new Error('Division by zero');
                }
                result = prev / current;
                break;
            default:
                return;
        }
        
        result = Math.round(result * 1000000000000) / 1000000000000;
        
        calc_currentExpression = calculation;
        calc_updateExpressionDisplay();
        
        calc_addToHistory(calculation, result);
        calc_currentInput = result.toString();
        calc_operator = '';
        calc_previousInput = '';
        calc_shouldResetDisplay = true;
        calc_updateDisplay();
        
    } catch (error) {
        document.getElementById('display').value = 'Error';
        calc_currentInput = '';
        calc_operator = '';
        calc_previousInput = '';
        calc_shouldResetDisplay = true;
        calc_currentExpression = '';
        calc_updateExpressionDisplay();
    }
}

function calc_clearAll() {
    calc_currentInput = '';
    calc_operator = '';
    calc_previousInput = '';
    calc_shouldResetDisplay = false;
    calc_currentExpression = '';  // Add this line
    calc_updateDisplay();
    calc_updateExpressionDisplay();  // Add this line
}

function calc_clearEntry() {
    calc_currentInput = '';
    calc_updateDisplay();
}

function calc_backspace() {
    if (calc_shouldResetDisplay) return;
    
    calc_currentInput = calc_currentInput.slice(0, -1);
    calc_updateDisplay();
}

// SIP Calculator
let chartInstance = null;
let growthChartInstance = null;

function calculateCompoundInterest() {
    const principal = parseFloat(document.getElementById('principal').value) || 0;
    const rate = parseFloat(document.getElementById('interestRate').value);
    const time = parseFloat(document.getElementById('timePeriod').value);
    const frequency = parseInt(document.getElementById('compoundingFrequency').value) || 1;
    const sipAmount = parseFloat(document.getElementById('recurringPayment').value) || 0;
    const sipfrequency = parseInt(document.getElementById('paymentFrequency').value) || 1;
    
    const stepupPercentage = parseFloat(document.getElementById('stepupPercentage').value) || 0;
    const isStepUpEnabled = stepupPercentage > 0;
    
    if (principal < 0) {
        alert('Please enter a valid principal amount');
        return;
    }
    if (!rate || rate <= 0) {
        alert('Please enter a valid interest rate');
        return;
    }
    if (!time || time <= 0) {
        alert('Please enter a valid time period');
        return;
    }
    
    let totalAmount = 0;
    let totalContributions = 0;
    let totalInterest = 0;
    let growthData = [];

    const annualRate = rate / 100;

    if (sipAmount > 0) {
        // ✅ SIP calculation with correct handling for decimal years
        let currentAmount = principal;
        let currentSip = sipAmount;
        const periodsPerYear = frequency;        // compounding frequency
        const sipPeriodsPerYear = sipfrequency;  // SIP deposits per year

        growthData = [];

        const fullYears = Math.floor(time);
        const remainder = time - fullYears;

        // Year 0 snapshot
        growthData.push({
            year: 0,
            totalAmount: currentAmount,
            contributions: principal,
            interest: 0
        });

        // Full years
        for (let y = 1; y <= fullYears; y++) {
            for (let p = 0; p < sipPeriodsPerYear; p++) {
                // deposit then compound until next deposit
                currentAmount += currentSip;
                currentAmount *= Math.pow(1 + annualRate / periodsPerYear, periodsPerYear / sipPeriodsPerYear);
            }
            if (isStepUpEnabled) {
                currentSip += (currentSip * stepupPercentage) / 100;
            }

            const contributionsSoFar = principal + (sipAmount * sipPeriodsPerYear * y);
            const interestEarned = currentAmount - contributionsSoFar;

            growthData.push({
                year: y,
                totalAmount: currentAmount,
                contributions: contributionsSoFar,
                interest: interestEarned
            });
        }

        // Partial year (if any)
        if (remainder > 0) {
            const partialDeposits = Math.floor(remainder * sipPeriodsPerYear + 1e-9); // deposits that occur in the remainder
            for (let p = 0; p < partialDeposits; p++) {
                currentAmount += currentSip;
                currentAmount *= Math.pow(1 + annualRate / periodsPerYear, periodsPerYear / sipPeriodsPerYear);
            }
            // leftover time after the last partial deposit until exact 'time'
            const leftoverYears = remainder - (partialDeposits / sipPeriodsPerYear);
            if (leftoverYears > 0) {
                currentAmount *= Math.pow(1 + annualRate / periodsPerYear, periodsPerYear * leftoverYears);
            }
        }

        totalAmount = currentAmount;
        // keep your existing contribution formula
        totalContributions = principal + (sipAmount * sipPeriodsPerYear * time);
        totalInterest = totalAmount - totalContributions;

    } else {
        // ✅ Lump sum only
        const compoundingRate = annualRate / frequency;
        const totalPeriods = time * frequency;

        growthData = [];
        for (let year = 0; year <= time; year++) {
            let amount;
            if (year === 0) {
                amount = principal;
            } else if (year === Math.ceil(time) && time % 1 !== 0) {
                const partialPeriods = frequency * time;
                amount = principal * Math.pow(1 + compoundingRate, partialPeriods);
            } else if (year <= time) {
                amount = principal * Math.pow(1 + compoundingRate, frequency * year);
            } else {
                break;
            }
            const interestEarned = amount - principal;
            growthData.push({
                year: year,
                totalAmount: amount,
                contributions: principal,
                interest: interestEarned
            });
        }

        totalAmount = principal * Math.pow(1 + compoundingRate, totalPeriods);
        totalContributions = principal;
        totalInterest = totalAmount - principal;
    }

    const totalReturn = totalContributions > 0 ? (totalInterest / totalContributions) * 100 : 0;

    const resultsContainer = document.getElementById('compoundResults');
    if (!resultsContainer) return;

    let stepUpInfo = '';
if (isStepUpEnabled && sipAmount > 0) {
    stepUpInfo = `<div class="result-note" style="font-size: 12px; color: var(--text-secondary); text-align: center; margin-top: 6px;">
        <b>📈 STEP-UP SIP: ${stepupPercentage}% YEARLY INCREASE</b>
    </div>`;
}


    resultsContainer.innerHTML = `
    <div class="result-card" style="background: linear-gradient(135deg, #e8f4f8, #a7f0ff);">
        <div class="result-label">Total Invested</div>
        <div class="result-value">${formatCurrency(totalContributions)}</div>
    </div>
    <div class="result-card" style="background: linear-gradient(135deg, #e8f5e9, #a7ffeb);">
        <div class="result-label">INTEREST / RETURN%</div>
        <div class="result-value">${formatCurrency(totalInterest)} (${totalReturn.toFixed(2)}%)</div>
    </div>
    <div class="result-card" style="background: linear-gradient(135deg, #e8f8e9, #a7ffb8);">
        <div class="result-label">Final Amount</div>
        <div class="result-value">${formatCurrency(totalAmount)}</div>
    </div>
    ${stepUpInfo}
    `;

    const rightPanel = document.getElementById('sipRightPanel');
    if (rightPanel) {
        rightPanel.classList.add('show');
    }

    try {
        createCompoundChart(totalContributions, totalInterest);
        createGrowthChart(growthData);
    } catch (error) {
        console.error('Chart creation error:', error);
    }

    saveSipCalculation(
        principal, sipAmount, rate, time, totalAmount,
        totalContributions, totalInterest, frequency,
        getFrequencyText(sipfrequency), growthData
    );
}



function createCompoundChart(principal, interest) {
    const canvas = document.getElementById('compoundChart');
    if (!canvas) return;
    
    const ctx = canvas.getContext('2d');
    
    if (chartInstance) {
        chartInstance.destroy();
        chartInstance = null;
    }
    
    // Include SIP in principal
    const sipAmount = parseFloat(document.getElementById('recurringPayment').value) || 0;
    const principalAmount = (parseFloat(principal) || 0) + sipAmount;
    const interestAmount = parseFloat(interest) || 0;
    
    if (principalAmount <= 0 && interestAmount <= 0) return;
    
    try {
        chartInstance = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['Total Invested', 'Interest Earned'],
                datasets: [{
                    data: [principalAmount, interestAmount],
                    backgroundColor: ['#1a73e8', '#34a853'],
                    borderColor: ['#ffffff', '#ffffff'],
                    borderWidth: 2,
                    hoverOffset: 4,
                    cutout: '60%'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                layout: {
                    padding: 8
                },
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        enabled: false
                    }
                },
                animation: {
                    animateRotate: true,
                    duration: 600
                }
            }
        });
        
        updatePercentageDisplay(principalAmount, interestAmount);
        
    } catch (error) {
        console.error('Chart creation failed:', error);
    }
}

function createGrowthChart(growthData) {
    const canvas = document.getElementById('growthChart');
    if (!canvas || !growthData || growthData.length === 0) return;

    // FIX: Set a fixed height only once to stop growing each refresh
    canvas.parentElement.style.height = "300px";
    
    const ctx = canvas.getContext('2d');
    
    if (growthChartInstance) {
        growthChartInstance.destroy();
        growthChartInstance = null;
    }
    
    try {
        const sipAmount = parseFloat(document.getElementById('recurringPayment').value) || 0;
        
        const labels = growthData.map(item => item.year.toString());
        const totalAmounts = growthData.map(item => item.totalAmount);
        const contributions = growthData.map(item => item.contributions);
        
        growthChartInstance = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: 'Total Amount',
                        data: totalAmounts,
                        borderColor: '#34a853',
                        backgroundColor: 'rgba(52, 168, 83, 0.1)',
                        fill: true,
                        tension: 0,
                        pointBackgroundColor: '#34a853',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 3,
                        pointHoverRadius: 5,
                        borderWidth: 3
                    },
                    {
                        label: 'Invested Amount',
                        data: contributions,
                        borderColor: '#1a73e8',
                        backgroundColor: 'rgba(26, 115, 232, 0.1)',
                        fill: true,
                        tension: 0,
                        pointBackgroundColor: '#1a73e8',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 3,
                        pointHoverRadius: 5,
                        borderWidth: 3
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                layout: {
                    padding: {
                        left: -6,
                        bottom: 34,
                        top: -2
                    }
                },
                interaction: {
                    intersect: false,
                    mode: 'index'
                },
                plugins: {
                    legend: {
                        display: true,
                        position: 'top',
                        labels: {
                            font: {
                                size: 12,
                                weight: 'bold'
                            },
                            usePointStyle: true,
                            boxWidth: 8,
                            boxHeight: 8,
                            padding: 4
                        }
                    },
                    tooltip: {
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        titleColor: '#ffffff',
                        bodyColor: '#ffffff',
                        borderColor: '#666',
                        borderWidth: 1,
                        cornerRadius: 6,
                        titleFont: {
                            size: 12,
                            weight: 'bold'
                        },
                        bodyFont: {
                            size: 11
                        },
                        padding: 12,
                        boxPadding: 3,
                        displayColors: true,
                        callbacks: {
                            title: function(tooltipItems) {
                                if (tooltipItems.length > 0) {
                                    const year = parseInt(tooltipItems[0].label);
                                    return year === 1 ? `After 1 Year` : `After ${year} Years`;
                                }
                                return '';
                            },
                            label: function(context) {
                                const label = context.dataset.label || '';
                                const value = formatCurrency(context.parsed.y);
                                return `${label}: ${value}`;
                            },
                            afterBody: function(tooltipItems) {
                                if (tooltipItems.length > 0) {
                                    const dataIndex = tooltipItems[0].dataIndex;
                                    const year = growthData[dataIndex].year;
                                    const totalInterest = growthData[dataIndex].interest;
                                    const prevTotalInterest = dataIndex > 0 ? growthData[dataIndex - 1].interest : 0;
                                    const yearlyInterest = totalInterest - prevTotalInterest;
                                    return [
                                        `Interest Earned: ${formatCurrency(totalInterest)}`,
                                        `${year}th Year Interest: ${formatCurrency(yearlyInterest)}`
                                    ];
                                }
                                return [];
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        grid: {
                            display: true,
                            color: 'rgba(0, 0, 0, 0.1)'
                        },
                        ticks: {
                            font: {
                                size: 12,
                                weight: 'bold'
                            },
                            padding: 0,
                            maxRotation: 0,
                            minRotation: 0
                        },
                        title: {
                            display: true,
                            text: 'Years',
                            font: {
                                size: 12,
                                weight: 'bold'
                            },
                            padding: {top: -2}
                        }
                    },
                    y: {
                        grid: {
                            color: 'rgba(0, 0, 0, 0.1)'
                        },
                        ticks: {
                            font: {
                                size: 12,
                                weight: 'bold'
                            },
                            padding: 2,
                            callback: function(value) {
                                if (currentCurrency === 'INR') {
                                    if (value >= 10000000) {
                                        return `₹${(value / 10000000).toFixed(1)}Cr`;
                                    } else if (value >= 100000) {
                                        return `₹${(value / 100000).toFixed(1)}L`;
                                    } else if (value >= 1000) {
                                        return `₹${(value / 1000).toFixed(0)}K`;
                                    } else {
                                        return `₹${value}`;
                                    }
                                } else {
                                    if (value >= 1000000) {
                                        return `$${(value / 1000000).toFixed(1)}M`;
                                    } else if (value >= 1000) {
                                        return `$${(value / 1000).toFixed(0)}K`;
                                    } else {
                                        return `$${value}`;
                                    }
                                }
                            }
                        },
                        title: {
                            display: true,
                            text: 'Amount',
                            font: {
                                size: 13,
                                weight: 'bold'
                            },
                            padding: {bottom: 0}
                        }
                    }
                },
                animation: {
                    duration: 1000,
                    easing: 'easeOutQuart'
                }
            }
        });

    } catch (error) {
        console.error('Growth chart creation failed:', error);
    }
}


function updatePercentageDisplay(principal, interest) {
    const total = principal + interest;
    const principalPercentage = total > 0 ? ((principal / total) * 100).toFixed(1) : 0;
    const interestPercentage = total > 0 ? ((interest / total) * 100).toFixed(1) : 0;
    
    const percentageContainer = document.getElementById('chartPercentages');
    percentageContainer.innerHTML = `
        <div class="percentage-item">
            <div class="percentage-left">
                <div class="percentage-color" style="background-color: #1a73e8;"></div>
                <span>INVESTED</span>
            </div>
            <div class="percentage-right">${principalPercentage}%</div>
        </div>
        <div class="percentage-item">
            <div class="percentage-left">
                <div class="percentage-color" style="background-color: #34a853;"></div>
                <span>RETURN</span>
            </div>
            <div class="percentage-right">${interestPercentage}%</div>
        </div>
    `;
}

// Close dropdowns when clicking outside
document.addEventListener('click', function(event) {
    const infoToggle = document.getElementById('infoToggle');
    const infoPopup = document.getElementById('infoPopup');
    const historyToggle = document.querySelector('.history-toggle-mini');
    const historyDropdown = document.getElementById('historyDropdownMini');
    
    if (!infoToggle.contains(event.target) && !infoPopup.contains(event.target)) {
        infoPopup.classList.remove('show');
    }
    
    if (historyToggle && historyDropdown && !historyToggle.contains(event.target) && !historyDropdown.contains(event.target)) {
        historyDropdown.classList.remove('open');
    }
});

// Keyboard Support
document.addEventListener('keydown', function(event) {
    // Basic Calculator keyboard support
    if (document.getElementById('basic').style.display === 'block') {
        const key = event.key;
        if (/[0-9]/.test(key)) {
            calc_appendNumber(key);
        } else if (key === '.') {
            calc_appendDecimal();
        } else if (['+', '-', '*', '/'].includes(key)) {
            calc_appendOperator(key);
        } else if (key === 'Enter' || key === '=') {
            calc_calculateResult();
        } else if (key === 'Escape' || key.toLowerCase() === 'c') {
            calc_clearAll();
        } else if (key === 'Backspace') {
            calc_backspace();
        }
        return;
    }
    
    // SIP Calculator Enter key support
    if (document.getElementById('sip').style.display !== 'none' && event.key === 'Enter') {
        const activeElement = document.activeElement;
        const sipInputs = ['principal', 'recurringPayment', 'interestRate', 'timePeriod'];
        
        if (sipInputs.includes(activeElement.id)) {
            calculateCompoundInterest();
            event.preventDefault();
        }
    }
});

// Initialize
calc_updateDisplay();
calc_updateExpressionDisplay();
calc_updateMiniHistoryDisplay();
</script>
</body>
</html>